function initCarousel(section,carouselIndex){const track=section.querySelector(".carousel-track"),slides=section.querySelectorAll(".carousel-slide"),indicators=section.querySelectorAll(".indicator"),nextBtn=section.querySelector(".carousel-next"),prevBtn=section.querySelector(".carousel-prev");if(!track||0===slides.length)return;let autoPlayInterval,currentSlide=0;function updateCarousel(){const isDesktop=window.innerWidth>=768;track.style.transform=isDesktop?`translateX(-${400*currentSlide}px)`:`translateX(-${100*currentSlide}%)`;Array.from(indicators).filter(indicator=>{const parent=indicator.parentElement;return isDesktop?parent.classList.contains("md:flex"):parent.classList.contains("md:hidden")}).forEach((indicator,index)=>{indicator.classList.toggle("active",index===currentSlide),index===currentSlide?(indicator.classList.add("bg-stone-600"),indicator.classList.remove("bg-stone-400")):(indicator.classList.add("bg-stone-400"),indicator.classList.remove("bg-stone-600"))})}function nextSlide(){const maxSlide=window.innerWidth>=768?Math.max(0,slides.length-3):slides.length-1;currentSlide<maxSlide?currentSlide++:currentSlide=0,updateCarousel()}function goToSlide(slideIndex){currentSlide=slideIndex,updateCarousel()}function startAutoPlay(){autoPlayInterval=setInterval(nextSlide,8e3)}function stopAutoPlay(){clearInterval(autoPlayInterval)}function restartAutoPlay(){stopAutoPlay(),startAutoPlay()}startAutoPlay(),track.addEventListener("mouseenter",stopAutoPlay),track.addEventListener("mouseleave",startAutoPlay),nextBtn&&nextBtn.addEventListener("click",()=>{nextSlide(),restartAutoPlay()}),prevBtn&&prevBtn.addEventListener("click",()=>{!function(){const maxSlide=window.innerWidth>=768?Math.max(0,slides.length-3):slides.length-1;currentSlide>0?currentSlide--:currentSlide=maxSlide,updateCarousel()}(),restartAutoPlay()});const desktopIndicators=Array.from(indicators).filter(ind=>ind.parentElement.classList.contains("md:flex")),mobileIndicators=Array.from(indicators).filter(ind=>ind.parentElement.classList.contains("md:hidden"));desktopIndicators.forEach((indicator,index)=>{indicator.addEventListener("click",()=>{goToSlide(index),restartAutoPlay()})}),mobileIndicators.forEach((indicator,index)=>{indicator.addEventListener("click",()=>{goToSlide(index),restartAutoPlay()})});section.querySelectorAll(".quantity-increase, .quantity-decrease").forEach(btn=>{btn.addEventListener("click",()=>{restartAutoPlay()})}),window.addEventListener("resize",()=>{updateCarousel()}),updateCarousel()}function initProductGalleryCarousel(){const gallery=document.querySelector("[data-product-gallery]");if(!gallery)return;const mainImages=gallery.querySelectorAll(".gallery-main-image"),thumbnails=gallery.querySelectorAll(".gallery-thumb-btn"),prevBtn=gallery.querySelector(".gallery-prev-btn"),nextBtn=gallery.querySelector(".gallery-next-btn"),currentImageSpan=gallery.querySelector(".current-image");gallery.querySelector(".total-images");if(0===mainImages.length)return;let currentIndex=0;const totalImages=mainImages.length;function showImage(index){currentIndex=index<0?totalImages-1:index>=totalImages?0:index,mainImages.forEach(img=>{img.classList.add("hidden")}),mainImages[currentIndex].classList.remove("hidden"),currentImageSpan&&(currentImageSpan.textContent=currentIndex+1),thumbnails.forEach((thumb,idx)=>{idx===currentIndex?(thumb.classList.remove("border-stone-200","hover:border-stone-300"),thumb.classList.add("border-teal-600","shadow-md")):(thumb.classList.remove("border-teal-600","shadow-md"),thumb.classList.add("border-stone-200","hover:border-stone-300"))})}function nextImage(){showImage(currentIndex+1)}function prevImage(){showImage(currentIndex-1)}prevBtn&&prevBtn.addEventListener("click",prevImage),nextBtn&&nextBtn.addEventListener("click",nextImage),thumbnails.forEach((thumb,index)=>{thumb.addEventListener("click",()=>{!function(index){showImage(index)}(index)})}),document.addEventListener("keydown",e=>{gallery&&("ArrowLeft"===e.key?prevImage():"ArrowRight"===e.key&&nextImage())}),showImage(0)}function initAddToCart(){const addToCartForm=document.querySelector("[data-add-to-cart-form]");if(!addToCartForm)return;const qtyInput=addToCartForm.querySelector("[data-qty-input]"),qtyDecrease=addToCartForm.querySelector("[data-qty-decrease]"),qtyIncrease=addToCartForm.querySelector("[data-qty-increase]"),addToCartBtn=addToCartForm.querySelector("[data-add-to-cart-btn]"),productId=addToCartForm.dataset.productId;qtyDecrease.addEventListener("click",()=>{const currentValue=parseInt(qtyInput.value)||1;currentValue>1&&(qtyInput.value=currentValue-1)}),qtyIncrease.addEventListener("click",()=>{const currentValue=parseInt(qtyInput.value)||1;qtyInput.value=currentValue+1}),qtyInput.addEventListener("change",()=>{(parseInt(qtyInput.value)||1)<1&&(qtyInput.value=1)}),addToCartBtn.addEventListener("click",async()=>{const quantity=parseInt(qtyInput.value)||1;addToCartBtn.disabled=!0;const originalText=addToCartBtn.textContent;addToCartBtn.textContent="Agregando...";try{const formData=new FormData;formData.append("product_id",productId),formData.append("quantity",quantity),formData.append("action","woocommerce_ajax_add_to_cart");const response=await fetch(wc_add_to_cart_params.ajax_url,{method:"POST",body:formData});(await response.json()).error?(addToCartBtn.textContent="Error",setTimeout(()=>{addToCartBtn.textContent=originalText,addToCartBtn.disabled=!1},2e3)):(document.body.dispatchEvent(new Event("wc_fragment_refresh")),addToCartBtn.textContent="✓ Agregado",addToCartBtn.classList.add("bg-green-600"),setTimeout(()=>{addToCartBtn.textContent=originalText,addToCartBtn.classList.remove("bg-green-600"),addToCartBtn.disabled=!1},2e3))}catch(error){addToCartBtn.textContent="Error",setTimeout(()=>{addToCartBtn.textContent=originalText,addToCartBtn.disabled=!1},2e3)}})}function initCartCounter(){updateCartCount()}function initQuantitySelectors(){const quantityDecrease=document.querySelectorAll(".quantity-decrease"),quantityIncrease=document.querySelectorAll(".quantity-increase");quantityDecrease.forEach(button=>{button.addEventListener("click",function(){const input=this.parentNode.querySelector(".quantity-input");let value=parseInt(input.value);value>1&&(input.value=value-1)})}),quantityIncrease.forEach(button=>{button.addEventListener("click",function(){const input=this.parentNode.querySelector(".quantity-input");let value=parseInt(input.value);input.value=value+1})})}function initAjaxAddToCart(){document.querySelectorAll(".ajax-add-to-cart").forEach(form=>{form.addEventListener("submit",function(e){e.preventDefault();const productId=this.dataset.productId,quantity=this.querySelector(".quantity-input").value,button=this.querySelector(".single_add_to_cart_button");button.disabled=!0,button.textContent="Agregando...";const formData=new FormData;formData.append("action","woocommerce_add_to_cart"),formData.append("product_id",productId),formData.append("quantity",quantity);const ajaxUrl=getAjaxUrl();fetch(ajaxUrl,{method:"POST",body:formData}).then(response=>response.text()).then(data=>{document.body.dispatchEvent(new CustomEvent("wc_fragment_refresh")),showNotification("Producto agregado al carrito","success"),button.disabled=!1,button.textContent="Agregar al carrito"}).catch(error=>{showNotification("Error al agregar al carrito","error"),button.disabled=!1,button.textContent="Agregar al carrito"})})})}function initCartPageUpdates(){if(document.body.classList.contains("woocommerce-cart")||window.location.href.includes("cart")){document.addEventListener("click",function(e){(e.target.closest("a.remove")||e.target.classList.contains("remove"))&&setTimeout(()=>{updateCartCount(),window.location.reload()},500),("update_cart"===e.target.name||e.target.closest('[name="update_cart"]'))&&setTimeout(()=>{updateCartCount()},1500)});document.querySelectorAll('input[name*="[qty]"]').forEach(input=>{input.addEventListener("change",function(){setTimeout(()=>{updateCartCount()},500)})});const cartForm=document.querySelector(".woocommerce-cart-form");cartForm&&cartForm.addEventListener("submit",function(){setTimeout(()=>{updateCartCount()},1500)})}}function getAjaxUrl(){let ajaxUrl="/wp-admin/admin-ajax.php";return"undefined"!=typeof wc_add_to_cart_params&&wc_add_to_cart_params.ajax_url?ajaxUrl=wc_add_to_cart_params.ajax_url:"undefined"!=typeof skal_ajax&&skal_ajax.ajax_url&&(ajaxUrl=skal_ajax.ajax_url),ajaxUrl}function updateCartCount(){const ajaxUrl=getAjaxUrl();fetch(ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_cart_count"})}).then(response=>response.json()).then(data=>{const cartCountElement=document.querySelector(".cart-count"),cartLink=document.querySelector('a[href*="cart"]')||document.querySelector('a[href*="carrito"]'),count=data.success?data.data.count:data.count;if(count>0)if(cartCountElement)cartCountElement.textContent=count;else{const span=document.createElement("span");span.className="cart-count absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",span.textContent=count,cartLink&&cartLink.appendChild(span)}else cartCountElement&&cartCountElement.remove()}).catch(error=>{})}if(document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("section").forEach((section,sectionIndex)=>{section.querySelector(".carousel-container")&&initCarousel(section,sectionIndex)}),initProductGalleryCarousel()}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initAddToCart):initAddToCart(),document.addEventListener("DOMContentLoaded",function(){initCartCounter(),initQuantitySelectors(),initAjaxAddToCart(),initAjaxAddToCartSpecial(),initCartPageUpdates(),initCartQuantityButtons(),initRemoveFromCart(),initOrderPopup()}),void 0===showNotification)function showNotification(message,type="info"){const notification=document.createElement("div");notification.className="fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full";const typeClasses={success:"bg-green-500 text-white",error:"bg-red-500 text-white",warning:"bg-yellow-500 text-black",info:"bg-blue-500 text-white"};notification.className+=` ${typeClasses[type]||typeClasses.info}`,notification.textContent=message,document.body.appendChild(notification),setTimeout(()=>{notification.classList.remove("translate-x-full")},100),setTimeout(()=>{notification.classList.add("translate-x-full"),setTimeout(()=>{notification.parentNode&&notification.parentNode.removeChild(notification)},300)},5e3)}function initCartQuantityButtons(){const decreaseButtons=document.querySelectorAll(".qty-decrease"),increaseButtons=document.querySelectorAll(".qty-increase"),qtyInputs=document.querySelectorAll(".qty-input");let debounceTimer;decreaseButtons.forEach(button=>{button.addEventListener("click",function(e){e.preventDefault();const cartKey=this.getAttribute("data-cart-key"),input=document.querySelector(`.qty-input[data-cart-key="${cartKey}"]`);if(input){let value=parseInt(input.value);if(value>(parseInt(input.getAttribute("min"))||0)){const newValue=value-1;input.value=newValue,updateCartQuantityAjax(cartKey,newValue)}}})}),increaseButtons.forEach(button=>{button.addEventListener("click",function(e){e.preventDefault();const cartKey=this.getAttribute("data-cart-key"),input=document.querySelector(`.qty-input[data-cart-key="${cartKey}"]`);if(input){let value=parseInt(input.value);if(value<(parseInt(input.getAttribute("max"))||999)){const newValue=value+1;input.value=newValue,updateCartQuantityAjax(cartKey,newValue)}}})}),qtyInputs.forEach(input=>{input.addEventListener("change",function(){clearTimeout(debounceTimer),debounceTimer=setTimeout(()=>{updateCartQuantityAjax(this.getAttribute("data-cart-key"),parseInt(this.value)||0)},500)})})}function updateCartQuantityAjax(cartKey,quantity){const ajaxUrl=getAjaxUrl(),nonce=getWooCommerceNonce(),input=document.querySelector(`.qty-input[data-cart-key="${cartKey}"]`);input&&(input.disabled=!0,input.style.opacity="0.5");const formData=new URLSearchParams({action:"update_cart_quantity",cart_key:cartKey,quantity:quantity,nonce:nonce});fetch(ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:formData}).then(response=>response.json()).then(data=>{if(data.success){if(updateCartCount(),data.data.subtotal){const productCard=input.closest(".rounded-xl.border.border-stone-200");if(productCard){const subtotalContainer=productCard.querySelector(".flex.flex-col.items-end.justify-end");if(subtotalContainer){const subtotalElement=subtotalContainer.querySelector("span.text-lg.text-stone-900");subtotalElement&&(subtotalElement.innerHTML=data.data.subtotal)}}}if(data.data.cart_total){const totalBox=document.querySelector(".border-teal-200.bg-teal-50");if(totalBox){const totalElement=totalBox.querySelector(".text-teal-700");totalElement&&(totalElement.innerHTML=data.data.cart_total)}}if(void 0!==data.data.cart_count){document.querySelectorAll(".cart-count").forEach(element=>{element.textContent=data.data.cart_count,data.data.cart_count>0?element.classList.remove("hidden"):element.classList.add("hidden")})}if(0===quantity){const productCard=input.closest(".rounded-xl");productCard&&(productCard.style.transition="opacity 0.3s",productCard.style.opacity="0",setTimeout(()=>{productCard.remove();0===document.querySelectorAll(".qty-input").length&&window.location.reload()},300))}showNotification("Carrito actualizado","success")}else showNotification(data.data.message||"Error al actualizar el carrito","error"),input&&data.data.old_quantity&&(input.value=data.data.old_quantity)}).catch(error=>{showNotification("Error al actualizar el carrito","error")}).finally(()=>{input&&(input.disabled=!1,input.style.opacity="1")})}function initRemoveFromCart(){document.querySelectorAll(".remove-from-cart").forEach(button=>{button.addEventListener("click",function(e){e.preventDefault();const cartKey=this.getAttribute("data-cart-key");if(!cartKey)return;wc_cart_params&&wc_cart_params.wc_ajax_url?wc_cart_params.wc_ajax_url.toString().replace("%%endpoint%%","remove_from_cart"):window.location.origin;if(confirm("¿Estás seguro de que quieres eliminar este producto del carrito?")){const currentUrl=new URL(window.location.href);currentUrl.searchParams.set("remove_item",cartKey),currentUrl.searchParams.set("_wpnonce",getWooCommerceNonce()),window.location.href=currentUrl.toString()}})})}function getWooCommerceNonce(){const nonceInput=document.querySelector('input[name="woocommerce-cart-nonce"]');return nonceInput?nonceInput.value:"undefined"!=typeof wc_cart_params&&wc_cart_params.nonce?wc_cart_params.nonce:""}function initOrderPopup(){const openButton=document.getElementById("open-order-popup"),closeButton=document.getElementById("close-order-popup"),popup=document.getElementById("order-popup"),orderForm=document.getElementById("order-details-form");if(!openButton||!popup)return;const celularInput=document.getElementById("customer-celular");celularInput&&(celularInput.addEventListener("input",function(e){this.value=this.value.replace(/[^0-9]/g,"")}),celularInput.addEventListener("keypress",function(e){e.key&&!/[0-9]/.test(e.key)&&"Backspace"!==e.key&&"Delete"!==e.key&&"Tab"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&e.preventDefault()})),openButton.addEventListener("click",function(e){e.preventDefault(),popup.classList.remove("hidden"),popup.classList.add("flex"),document.body.style.overflow="hidden"}),closeButton&&closeButton.addEventListener("click",function(e){e.preventDefault(),popup.classList.add("hidden"),popup.classList.remove("flex"),document.body.style.overflow=""}),popup.addEventListener("click",function(e){e.target===popup&&(popup.classList.add("hidden"),popup.classList.remove("flex"),document.body.style.overflow="")}),orderForm&&orderForm.addEventListener("submit",function(e){e.preventDefault();const submitButton=document.getElementById("submit-order-btn"),originalText=submitButton.textContent;submitButton.disabled=!0,submitButton.textContent="Procesando...",submitButton.style.opacity="0.6",submitButton.style.cursor="not-allowed",submitButton.classList.add("pointer-events-none");const formData=new FormData(orderForm),customerData={nombre:formData.get("nombre"),apellido:formData.get("apellido"),celular:formData.get("celular"),zona:formData.get("zona"),direccion:formData.get("direccion"),tratamiento_datos:formData.get("tratamiento_datos")},ajaxUrl=getAjaxUrl(),requestData=new URLSearchParams({action:"process_custom_order",nonce:getWooCommerceNonce(),customer_data:JSON.stringify(customerData)});fetch(ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:requestData}).then(response=>response.json()).then(data=>{data.success?(showNotification("¡Orden realizada con éxito!","success"),setTimeout(()=>{data.data.redirect_url?window.location.href=data.data.redirect_url:window.location.reload()},1500)):(showNotification(data.data.message||"Error al procesar la orden","error"),submitButton.disabled=!1,submitButton.textContent=originalText,submitButton.style.opacity="1",submitButton.style.cursor="pointer",submitButton.classList.remove("pointer-events-none"))}).catch(error=>{showNotification("Error al procesar la orden","error"),submitButton.disabled=!1,submitButton.textContent=originalText,submitButton.style.opacity="1",submitButton.style.cursor="pointer",submitButton.classList.remove("pointer-events-none")})})}function initAjaxAddToCartSpecial(){const specialForm=document.querySelector(".ajax-add-to-cart-special");specialForm&&specialForm.addEventListener("submit",function(e){e.preventDefault();const productId=this.dataset.productId,quantity=this.querySelector('input[name="quantity"]').value,button=this.querySelector(".special-add-to-cart-btn"),originalText=(document.getElementById("cart-notification"),button.innerHTML);button.disabled=!0,button.innerHTML="⏳ Agregando...";const ajaxUrl=getAjaxUrl(),formData=new URLSearchParams({action:"woocommerce_ajax_add_to_cart",product_id:productId,quantity:quantity});fetch(ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:formData}).then(response=>response.json()).then(data=>{if(data.error)throw new Error(data.error);updateCartCount(),window.location.href="/carrito/"}).catch(error=>{alert("Error al agregar el producto al carrito. Por favor, intenta nuevamente."),button.disabled=!1,button.innerHTML=originalText})})}function showNotification(message,type="info"){const notification=document.createElement("div");notification.className="fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full";const typeClasses={success:"bg-green-500 text-white",error:"bg-red-500 text-white",warning:"bg-yellow-500 text-black",info:"bg-blue-500 text-white"};notification.className+=` ${typeClasses[type]||typeClasses.info}`,notification.textContent=message,document.body.appendChild(notification),setTimeout(()=>{notification.classList.remove("translate-x-full")},100),setTimeout(()=>{notification.classList.add("translate-x-full"),setTimeout(()=>{notification.parentNode&&notification.parentNode.removeChild(notification)},300)},5e3)}document.addEventListener("DOMContentLoaded",function(){const mobileMenuButton=document.getElementById("mobile-menu-button"),mobileMenu=document.getElementById("mobile-menu");mobileMenuButton&&mobileMenu&&mobileMenuButton.addEventListener("click",function(){mobileMenu.classList.toggle("hidden");const icon=mobileMenuButton.querySelector("svg");mobileMenu.classList.contains("hidden")?icon.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>':icon.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>'}),document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();const target=document.querySelector(this.getAttribute("href"));target&&target.scrollIntoView({behavior:"smooth"})})});document.querySelectorAll("form").forEach(form=>{form.addEventListener("submit",function(){const submitButton=form.querySelector('button[type="submit"], input[type="submit"]');submitButton&&(submitButton.disabled=!0,submitButton.classList.add("opacity-50","cursor-not-allowed"),setTimeout(()=>{submitButton.disabled=!1,submitButton.classList.remove("opacity-50","cursor-not-allowed")},3e3))})}),"undefined"!=typeof wc_add_to_cart_params&&document.body.addEventListener("added_to_cart",function(){document.querySelector(".cart-count")});const observer=new IntersectionObserver(function(entries){entries.forEach(entry=>{entry.isIntersecting&&(entry.target.classList.add("animate-fade-in"),observer.unobserve(entry.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".fade-on-scroll").forEach(el=>observer.observe(el))});